<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kedvenc Szavak Teszt - Token Alap√∫ Hiteles√≠t√©s</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.danger {
            background-color: #dc3545;
        }
        button.danger:hover {
            background-color: #c82333;
        }
        button.success {
            background-color: #28a745;
        }
        button.success:hover {
            background-color: #218838;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        .favorite-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .favorite-item h4 {
            margin: 0 0 5px 0;
            color: #007bff;
        }
        .favorite-item p {
            margin: 5px 0;
            color: #666;
        }
        .favorite-item small {
            color: #888;
        }
    </style>
</head>
<body>
    <h1>üîê Kedvenc Szavak API Teszt - Token Alap√∫ Hiteles√≠t√©s</h1>
    
    <!-- Token kezel√©s -->
    <div class="container">
        <h2>1. Token Be√°ll√≠t√°sa</h2>
        <div class="input-group">
            <label for="tokenInput">JWT Token (bejelentkez√©s ut√°n kapott token):</label>
            <textarea id="tokenInput" placeholder="Ide illeszd be a JWT tokent..."></textarea>
        </div>
        <button onclick="saveToken()">Token Ment√©se LocalStorage-ba</button>
        <button onclick="loadToken()" class="success">Token Bet√∂lt√©se</button>
        <button onclick="clearToken()" class="danger">Token T√∂rl√©se</button>
        
        <div id="tokenStatus"></div>
    </div>

    <!-- Bejelentkez√©s teszt -->
    <div class="container">
        <h2>2. Bejelentkez√©s Teszt</h2>
        <div class="grid">
            <div>
                <div class="input-group">
                    <label for="username">Felhaszn√°l√≥n√©v:</label>
                    <input type="text" id="username" placeholder="pl: admin">
                </div>
                <div class="input-group">
                    <label for="password">Jelsz√≥:</label>
                    <input type="text" id="password" placeholder="jelsz√≥">
                </div>
                <button onclick="login()">Bejelentkez√©s</button>
            </div>
            <div>                <div class="input-group">
                    <label for="baseUrl">API Base URL:</label>
                    <input type="text" id="baseUrl" value="https://localhost:7223/api" placeholder="https://localhost:7223/api">
                </div>
            </div>
        </div>
        <div id="loginResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Kedvenc szavak m≈±veletek -->
    <div class="container">
        <h2>3. Kedvenc Szavak Lek√©r√©se</h2>
        <button onclick="getFavoriteWords()">Kedvenc Szavak Lek√©r√©se</button>
        <button onclick="getLearnedWords()" class="success">Megtanult Szavak Lek√©r√©se</button>
        
        <div id="wordsResponse" class="response" style="display: none;"></div>
        <div id="wordsList"></div>
    </div>

    <!-- √öj kedvenc sz√≥ hozz√°ad√°sa -->
    <div class="container">
        <h2>4. √öj Kedvenc Sz√≥ Hozz√°ad√°sa</h2>
        <div class="input-group">
            <label for="dictionaryEntryId">Dictionary Entry ID (GUID):</label>
            <input type="text" id="dictionaryEntryId" placeholder="pl: 12345678-1234-1234-1234-123456789012">
        </div>
        <button onclick="addFavoriteWord()">Kedvenc Sz√≥ Hozz√°ad√°sa</button>
        
        <div id="addResponse" class="response" style="display: none;"></div>
    </div>

    <!-- Dictionary szavak lek√©r√©se -->
    <div class="container">
        <h2>5. Sz√≥t√°r Szavak (Dictionary Entries)</h2>
        <div class="input-group">
            <label for="searchTerm">Keresett sz√≥ (opcion√°lis):</label>
            <input type="text" id="searchTerm" placeholder="pl: hello">
        </div>
        <button onclick="getDictionaryEntries()">Sz√≥t√°r Szavak Lek√©r√©se</button>
        
        <div id="dictionaryResponse" class="response" style="display: none;"></div>
        <div id="dictionaryList"></div>
    </div>

    <script>        // Global v√°ltoz√≥k
        let currentToken = null;
        let baseApiUrl = 'https://localhost:7223/api';

        // Token kezel√©s
        function saveToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showStatus('tokenStatus', 'K√©rlek adj meg egy tokent!', 'error');
                return;
            }
            
            localStorage.setItem('jwtToken', token);
            currentToken = token;
            showStatus('tokenStatus', 'Token sikeresen mentve a LocalStorage-ba!', 'success');
            
            // Token info megjelen√≠t√©se
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                showStatus('tokenStatus', `Token mentve! Felhaszn√°l√≥: ${payload.sub || 'N/A'}, Lej√°rat: ${new Date(payload.exp * 1000).toLocaleString()}`, 'success');
            } catch (e) {
                showStatus('tokenStatus', 'Token mentve, de nem siker√ºlt dek√≥dolni!', 'info');
            }
        }

        function loadToken() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                document.getElementById('tokenInput').value = token;
                currentToken = token;
                showStatus('tokenStatus', 'Token bet√∂ltve a LocalStorage-b√≥l!', 'success');
                
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    showStatus('tokenStatus', `Token bet√∂ltve! Felhaszn√°l√≥: ${payload.sub || 'N/A'}, Lej√°rat: ${new Date(payload.exp * 1000).toLocaleString()}`, 'success');
                } catch (e) {
                    showStatus('tokenStatus', 'Token bet√∂ltve, de nem siker√ºlt dek√≥dolni!', 'info');
                }
            } else {
                showStatus('tokenStatus', 'Nincs mentett token a LocalStorage-ban!', 'error');
            }
        }

        function clearToken() {
            localStorage.removeItem('jwtToken');
            document.getElementById('tokenInput').value = '';
            currentToken = null;
            showStatus('tokenStatus', 'Token t√∂r√∂lve!', 'info');
        }

        // Bejelentkez√©s
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            baseApiUrl = document.getElementById('baseUrl').value.trim();

            if (!username || !password) {
                showResponse('loginResponse', 'K√©rlek add meg a felhaszn√°l√≥nevet √©s jelsz√≥t!', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseApiUrl}/user/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userName: username,
                        password: password
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('tokenInput').value = data.token;
                    currentToken = data.token;
                    localStorage.setItem('jwtToken', data.token);
                    
                    showResponse('loginResponse', 
                        `Sikeres bejelentkez√©s!\nToken: ${data.token}\nLej√°rat: ${new Date(data.expiration).toLocaleString()}`, 
                        'success');
                } else {
                    showResponse('loginResponse', `Bejelentkez√©si hiba: ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResponse('loginResponse', `H√°l√≥zati hiba: ${error.message}`, 'error');
            }
        }

        // Kedvenc szavak lek√©r√©se
        async function getFavoriteWords() {
            if (!currentToken && !loadStoredToken()) {
                showResponse('wordsResponse', 'Nincs token! K√©rlek jelentkezz be vagy add meg a tokent.', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseApiUrl}/userwords/favorites`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('wordsResponse', JSON.stringify(data, null, 2), 'success');
                    displayWordsList(data, 'favorite');
                } else {
                    showResponse('wordsResponse', `Hiba: ${response.status} - ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResponse('wordsResponse', `H√°l√≥zati hiba: ${error.message}`, 'error');
            }
        }

        // Megtanult szavak lek√©r√©se
        async function getLearnedWords() {
            if (!currentToken && !loadStoredToken()) {
                showResponse('wordsResponse', 'Nincs token! K√©rlek jelentkezz be vagy add meg a tokent.', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseApiUrl}/userwords/learned`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('wordsResponse', JSON.stringify(data, null, 2), 'success');
                    displayWordsList(data, 'learned');
                } else {
                    showResponse('wordsResponse', `Hiba: ${response.status} - ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResponse('wordsResponse', `H√°l√≥zati hiba: ${error.message}`, 'error');
            }
        }

        // √öj kedvenc sz√≥ hozz√°ad√°sa
        async function addFavoriteWord() {
            if (!currentToken && !loadStoredToken()) {
                showResponse('addResponse', 'Nincs token! K√©rlek jelentkezz be vagy add meg a tokent.', 'error');
                return;
            }

            const dictionaryEntryId = document.getElementById('dictionaryEntryId').value.trim();
            if (!dictionaryEntryId) {
                showResponse('addResponse', 'K√©rlek adj meg egy Dictionary Entry ID-t!', 'error');
                return;
            }

            try {
                const response = await fetch(`${baseApiUrl}/userwords/favorites`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        dictionaryEntryId: dictionaryEntryId
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('addResponse', `Kedvenc sz√≥ sikeresen hozz√°adva!\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResponse('addResponse', `Hiba: ${response.status} - ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResponse('addResponse', `H√°l√≥zati hiba: ${error.message}`, 'error');
            }
        }        // Dictionary entries lek√©r√©se (seg√©dlet a tesztel√©shez)
        async function getDictionaryEntries() {
            const searchTerm = document.getElementById('searchTerm').value.trim();
            let url = `${baseApiUrl}/dictionary/listFiveHundred`;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('dictionaryResponse', JSON.stringify(data, null, 2), 'success');
                    displayDictionaryList(data);
                } else {
                    showResponse('dictionaryResponse', `Hiba: ${response.status} - ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResponse('dictionaryResponse', `H√°l√≥zati hiba: ${error.message}`, 'error');
            }
        }

        // Seg√©df√ºggv√©nyek
        function loadStoredToken() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                currentToken = token;
                return true;
            }
            return false;
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
        }

        function showResponse(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `response ${type}`;
            element.style.display = 'block';
        }

        function displayWordsList(words, type) {
            const container = document.getElementById('wordsList');
            
            if (!words || words.length === 0) {
                container.innerHTML = `<p>Nincs ${type === 'favorite' ? 'kedvenc' : 'megtanult'} sz√≥.</p>`;
                return;
            }

            let html = `<h3>${type === 'favorite' ? 'Kedvenc' : 'Megtanult'} Szavak (${words.length} db)</h3>`;
            
            words.forEach(word => {
                html += `
                    <div class="favorite-item">
                        <h4>${word.englishPhrase}</h4>
                        <p><strong>Magyar jelent√©s:</strong> ${word.hungarianMeanings}</p>
                        <small>ID: ${word.id} | Dictionary ID: ${word.dictionaryEntryId}</small>
                        <br>
                        <small>${type === 'favorite' ? 'Hozz√°adva' : 'Megtanulva'}: ${new Date(word.addedAt || word.learnedAt).toLocaleString()}</small>
                        ${word.lastClickedAt ? `<br><small>Utolj√°ra kattintva: ${new Date(word.lastClickedAt).toLocaleString()}</small>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayDictionaryList(entries) {
            const container = document.getElementById('dictionaryList');
            
            if (!entries || entries.length === 0) {
                container.innerHTML = '<p>Nincs sz√≥t√°r bejegyz√©s.</p>';
                return;
            }

            let html = `<h3>Sz√≥t√°r Bejegyz√©sek (${entries.length} db)</h3>`;
            
            entries.slice(0, 10).forEach(entry => { // Csak az els≈ë 10-et mutatjuk
                html += `
                    <div class="favorite-item">
                        <h4>${entry.englishPhrase}</h4>
                        <p><strong>Magyar jelent√©s:</strong> ${entry.hungarianMeanings}</p>
                        <small>ID: ${entry.id}</small>
                        <button onclick="document.getElementById('dictionaryEntryId').value='${entry.id}'" style="margin-left: 10px; font-size: 12px; padding: 2px 8px;">
                            ID M√°sol√°sa
                        </button>
                    </div>
                `;
            });
            
            if (entries.length > 10) {
                html += `<p><em>... √©s m√©g ${entries.length - 10} bejegyz√©s</em></p>`;
            }
            
            container.innerHTML = html;
        }

        // Oldal bet√∂lt√©sekor pr√≥b√°lja meg bet√∂lteni a mentett tokent
        window.onload = function() {
            loadToken();
        };
    </script>
</body>
</html>
